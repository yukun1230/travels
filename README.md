# 牛牛旅行日记 ---- 旅行日记平台 

## 项目简介

”牛牛旅行日记“ 是一个综合性的游记内容发布与管理平台，主要分为移动端 App（travels_mobile）、PC 网页站点审核管理系统（travel_admin）和后端服务系统（travels_server）三大模块。项目致力于为用户提供一个记录、分享旅行见闻的平台，并通过 PC 站点内容审核管理系统确保平台内容的合规性和质量。

**【备注】：想更详细地了解各个模块，可以查看各文件夹内的README.md文档**\
[移动端 App](./travels_mobile/README.md)\
[PC 网页站点审核管理系统](./travel_admin/README.md)\
[后端服务系统](./travels_server/README.md)

## 项目模块

1. **用户移动端 App：** 移动端 App用户系统提供了注册、登录、游记浏览、发布、分享以及收藏等功能。用户可以在移动端 App上记录自己的旅行经历、上传旅行照片，并与其他用户分享自己的旅行故事和心得。该板块旨在为用户提供一个优质、便捷、高效的移动端体验。
2. **PC 网页站点审核：** PC 网页站点作为后台审核管理系统，提供了对用户发布的游记进行管理筛选、审核检查、删除等操作的功能。不同角色的管理员可以登录系统进行游记的审核管理，确保平台内容的合规性和质量。该模块为管理员提供了一个直观、高效的审核管理界面。
3. **后端服务搭建：** 后端服务系统模块负责搭建和维护旅游日记平台的后端服务，包括用户信息管理、游记发布管理、审核管理等功能。后端服务通过接口与移动端 App用户系统 和 PC 网页站点审核管理系统进行交互，为整个平台提供数据支持和业务逻辑处理。

## 技术栈

### 移动端

1. **Expo ：** Expo 是一个用于构建跨平台应用的开发工具包，它提供了许多方便的功能和组件，如内置的 UI 组件库、API 接口、打包工具等，使得开发过程更加简单和高效。我们选择使用 Expo 框架快速搭建起项目的基础结构，并利用其丰富的功能来加速开发和提升用户体验。
2. **React Native ：** 基于 React Native 框架进行开发，可以使用 JavaScript 和 React 的知识来构建原生移动应用。React Native 提供了丰富的组件和 API，使得开发者可以轻松地创建流畅、高性能的用户界面。
3. **Redux ：** 使用 Redux 进行状态管理，统一管理应用的状态和数据流。Redux 提供了一种可预测的状态管理机制，使得应用的状态变化变得可控和可追踪，便于开发和调试复杂的应用逻辑。
4. **React Navigation ：** 通过 React Navigation 库实现应用的导航功能，包括页面跳转、导航栏定制、路由配置等。React Navigation 提供了灵活且易于使用的导航组件，使得开发者可以快速构建流畅的用户导航体验。
5. **Axios：** 通过 `Axios` 库发送 HTTP 请求与后端进行数据交互，包括用户登录、注册、获取数据等功能。`Axios` 是一个基于 Promise 的 HTTP 客户端，提供了简洁和易用的 API，适用于浏览器和 Node.js 环境。
6. **React Native Paper：** 作为基于 Material Design 的 UI 组件库，React Native Paper 专为 React Native 应用程序设计，它遵循 Material Design 设计规范，提供了一系列简单易用的符合 Material Design 样式的 UI 组件，可以帮助开发者快速构建符合 Material Design 样式的用户界面。

### PC端

1. **React 框架：** 使用 React 框架构建用户界面，通过组件化的开发模式提高代码复用性和维护性。
2. **Ant Design：** 使用 Ant Design 作为 UI 组件库，提供了丰富的组件和样式，使得界面设计更加美观和易用。
3. **Redux 管理状态：** 使用 Redux 进行状态管理，统一管理应用的状态和数据流，提高了应用的可维护性和可扩展性。
4. **Axios 发送 HTTP 请求：** 使用` Axios` 库发送 HTTP 请求与后端进行数据交互，保证了数据的安全传输和可靠性。

### 后端

1. **Node.js 平台：** 使用 Node.js 平台进行后端服务的开发，借助其高效的异步 I/O 模型和丰富的生态系统，实现了快速开发和部署。
2. **Express 框架：** 使用 Express 框架构建后端服务的路由和控制逻辑，提供了灵活的路由管理和中间件支持。
3. **MongoDB 数据库：** 使用 MongoDB 数据库存储应用的数据，采用 NoSQL 数据库的优势，实现了数据的高效存储和查询。
4. **JWT 鉴权机制：** 使用 JWT（JSON Web Token）进行用户身份验证和授权管理，保证了用户信息的安全性和可靠性。

## 项目亮点

### 移动端

1. **成功打包成` .apk `文件并在多台安卓手机上成功安装运行：** 作为一个基于 React Native 的移动端应用，成功打包成` .apk `文件并能够在手机上成功安装运行是项目的重要里程碑。这意味着我们的应用已经具备了上线发布的基本条件，用户可以通过安装包方便地在自己的手机上安装和使用。
2. **点赞和收藏功能：** 项目实现了点赞和收藏功能，用户可以在阅读游记时对喜欢的内容进行点赞和收藏，将其添加到个人收藏页面进行浏览和管理。这样的功能不仅增加了用户的参与度和互动性，还可以帮助用户快速定位自己感兴趣的内容，提升用户体验和粘性。
3. **分享功能：** 项目提供了分享功能，用户可以将自己喜欢的游记分享到其他社交软件平台，如微信、微博等，也可以将游记的 H5 承接页地址分享给好友，让更多人了解和欣赏到自己的旅行见闻。分享功能的实现不仅可以扩大平台的用户覆盖范围，还可以为用户提供更多的曝光和交流机会，促进平台内容的传播和用户的互动。
4. **页面性能优化：** 在上传图片到服务器之前，对图片进行压缩和优化，以减小图片文件的大小，加快加载速度。同时，根据图片在页面中的显示大小，提前生成适当尺寸的缩略图，以减少加载时间；使用FlatList将大量图片列表分页加载，每次只加载一页的图片，当用户浏览到页面底部时，再加载下一页的图片。这可以降低服务器和客户端的负载，提高用户体验；在图片加载完成前，显示加载图标，以提供更好的用户体验，减少页面内容的跳动。
5. **添加个人信息更新功能：** 提供一个用户友好的界面，使用户能够轻松地查看、编辑和更新其个人信息。在我的游记页面，点击个人头像弹出下拉框，里面有一个选项便是编辑用户信息，在界面中能够更换头像、昵称，添加性别、个人简介，提交后数据库中保存的个人信息随之更新，能够及时反映在app的全部界面。
6. **游记详情页大图浏览功能：** 在图片详情页点击图片进入一个全屏浏览模式，以便查看图片的更多细节或者以全屏模式欣赏图片，在全屏模式下，用户能够使用手势来控制图片，比如滑动、缩放等。这样他们可以轻松地浏览和放大图片，以查看细节。用户再次点击图片即能够退出全屏浏览模式，回到游记详情页。
7. **游记发布界面内容填写框高度随内容行数递增：** 通过`TextInput`的`onContentSizeChange={(e) => setHeight(e.nativeEvent.contentSize.height)}`属性保存图片高度状态，之后将高度信息反馈到文本框的样式中。
8. **用户token存于AsyncStorage：** 我们在AsyncStorage的基础上做一层抽象封装，使其达到与web端LocalStorage一样的效果。

### PC端

1. **筛选与过滤功能增强：** 系统支持根据不同的游记状态、游记发布时间、游记标题进行筛选和过滤，这样操作人员可以根据自己的需求快速找到目标游记，提高了系统的可用性和便捷性。这种功能增强了系统的灵活性，使得操作人员可以更加高效地管理大量的游记数据。

### 服务端

1. **简洁明了的接口名称：** 使得项目具有良好的易用性和可读性。
2. **用户鉴权：** 采用了中间件验证`token`的设计，代码逻辑更加直观，通过提高了系统的安全性。
3. **数据库：** 用户密码通过`bcrypt`进行加密后存储在数据库中，有效的保障了用户的隐私安全。

```json
{
    "_id" : ObjectId("660b589094d0731fcaf0b00d"),
    "username" : "yukun",
    "nickname" : "套娃甜甜",
    "password" : "$2b$10$rtlaQu0/6/iUHlC27tPpheHm011NQdQ5DcC8RJ41rUVnUNE/t2zPC",
    "avatar" : "http://5fvskc9y2ble.xiaomiqiu.com/public/avatarUploads/1713278556502.jpeg",
    "createTime" : ISODate("2024-04-02T01:00:00.391Z"),
    "updateTime" : ISODate("2024-04-02T01:00:00.391Z"),
    "__v" : 0,
    "collectTravels" : [ 
        "660d662877d1fe0ef4ab3e38", 
        "661231dabcd45d58c3de504c", 
        "660f5f4bc368540a9f9a29e8", 
        "6617f69087c486fb858c78da", 
        "66123327bcd45d58c3de5164", 
        "660e4f6a3e7759684e612275"
    ],
    "gender" : "男",
    "likeTravels" : [ 
        "660e480b3e7759684e61224b", 
        "660d662877d1fe0ef4ab3e38", 
        "660e4f6a3e7759684e612275"
    ],
    "introduction" : "风萧萧兮易水寒"
}
```

# 难点突破

### 移动端

1. **首页游记卡片瀑布流布局的实现：** 实现首页游记卡片的瀑布流布局是一个较为复杂的问题，需要考虑不同设备屏幕尺寸和内容高度的适配，以及卡片间距的动态调整。通过引入react-native-waterfall-flow 库，进行相应的配置以及自定义样式表，我们成功实现了响应式的瀑布流布局，确保了页面在不同设备上的美观和稳定性。
2. **首页瀑布流卡片分页数据的加载：** 首页瀑布流卡片数据量较大，需要进行分页加载以提升页面加载速度和用户体验。我们采用了分页加载技术，通过监听滚动事件，定义了一个`loadData` 函数，当用户滚动到页面底部时触发，自动向后端发送请求，获取下一页的数据来更新数据；驱动下一页瀑布流卡片的渲染，有效减轻了客户端和服务器的压力，并保证了页面的流畅性和性能。
3. **首页底部继续加载、顶部下拉刷新、搜索状态的控制：** 由于搜索没有采用额外的路由页面，首页所有功能都在同一页面完成，实现首页底部继续加载、顶部下拉刷新和搜索这三个状态的控制是一个涉及多个组件和状态管理的复杂问题。通过在异步函数中及时的变更状态，确保了底部继续加载和顶部下拉刷新以及搜索功能的及时响应。
4. **界面在不同设备的显示差异：** 移动设备的屏幕尺寸和分辨率各不相同，因此需要对界面进行适配和优化，确保在不同设备上都能够良好地显示和使用。我们通过尽量使用flex布局与百分比单位样式，尽可能保证用户在任何设备上都能够获得一致的使用体验。

### PC端

1. **设计和实现角色权限管理系统，确保只有授权用户才能进行审核和管理操作，并且防止未授权访问和数据泄露。**

   **解决方案：** 使用Token做路由权限控制（`AuthRoute`），如果用户没有经过登录获取到有效Token，是没有权限跳转的，根据Token的有无控制当前路由是否可以跳转。

2. **处理大量的游记数据和用户访问请求，保证系统的稳定性和响应速度。**

   **解决方案：** 实现分页功能

- **实现效果：** 点击页数，在Table中显示当前页的游记数据列表

- **如何实现：**

  (1) 实现分页展示 （页数 = 总数 / 每页条数）

  (2) 点击分页拿到当前点击的页数

  (3) 使用页数作为请求参数重新获取游记列表渲染

3. **设计用户友好的界面，让用户能够轻松理解并快速完成操作。**

   **解决方案：** Ant Design 是由蚂蚁金服出品的社区使用最广的React PC端组件库，内置了常用的现成组件，可以帮助我们快速开发PC管理后台项目；进行初步界面设计，了解用户需求和行为习惯，从而设计出直观、简洁的界面。进行测试和反馈收集，及时调整和优化界面设计，以提升用户体验。

   (1) 游记审核完成后，仍可查看。

   (2) 点击下一页后回到页面顶部。

   (3) 点击删除按钮进行删除游记操作时，需要审核人员进一步的确认，就近弹出浮层提示，询问是否继续执行删除操作，防止误操作。

### 服务端

1. **后端服务的 `Ngrok` 内网穿透：** 在开发过程中，为了方便测试和调试，我们使用了 `Ngrok` 内网穿透服务将本地的后端服务暴露到公网，实现了远程访问和调试。`Ngrok `内网穿透服务极大地提高了开发效率和团队协作的便利性，帮助我们及时发现和解决后端服务的问题。

2. **操作MongoDB数据库：** MongoDB 是一个文档数据库，以文档形式存储数据，格式类似于 JSON，

3. **表单以及文件的联合上传：** 由于瀑布流组件(react-native-waterfall-flow)需要用到图片的长宽信息，但是长宽信息无法作为图片文件的属性，因此我们将图片的长宽信息作为额外的字段（图片ID对应的长宽信息）一起发送到后端。在 Express 服务器端，我们使用 `Multer` 处理文件上传，同时从请求中获取额外的图片长宽信息。最后按照下面的形式将游记信息存储于`mongodb`数据库中。

```json
{
    "_id" : ObjectId("661682eebc8460fa13ec34b3"),
    "photo" : [ 
        {
            "uri" : "http://5fvskc9y2ble.xiaomiqiu.com/public/photos/1712751341232.jpeg",
            "height" : 1280,
            "width" : 960,
            "_id" : ObjectId("661682eebc8460fa13ec34b4")
        }
    ],
    "title" : "BUG",
    "content" : "CCCCC",
    "location" : {
        "country" : "undefined",
        "province" : "undefined",
        "city" : "undefined"
    },
    "travelState" : 3,
    "userId" : "660ce2eb470d99899684c4f2",
    "userInfo" : {
        "nickname" : "kevin888",
        "avatar" : "http://5fvskc9y2ble.xiaomiqiu.com/public/avatarUploads/1712120555790.kevin888.jpeg"
    },
    "collectedCount" : 1,
    "createTime" : ISODate("2024-04-10T12:15:42.334Z"),
    "updateTime" : ISODate("2024-04-10T12:15:42.334Z"),
    "__v" : 0,
    "likedCount" : 1
}
```

